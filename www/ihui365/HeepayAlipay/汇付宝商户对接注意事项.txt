
汇付宝商户对接注意事项（通用）2015-08-13

接口提交方式
GET/POST方式发送HTTP协议请求

接口编码格式
接口参数提交使用GB2312/GBK，签名计算使用UTF-8

接口返回值格式
XML

概念解释
签名验证
每个接口都规定了需要参与签名的参数和顺序，以及是否需要转换大小写等其他要求，商户本地计算签名值并作为参数提交，我方也会本地计算签名值并和商户传过来的签名值比对，如果相同则验证通过，否则不通过。商户接收我方的通知信息时的签名验证方式雷同。签名验证的目的是保证接口双方

同步返回
商户通过发送HTTP协议请求调用接口，我方处理完毕，立即跳转至商户提交的同步地址（return_url）并将订单处理结果数据返回至该地址，在有异步通知的前提下，通常，同步通知页面仅作为支付结果的信息展示，不做业务逻辑处理；

异步返回
商户通过发送HTTP协议请求调用接口，我方校验通过后，往商户提交的异步通知地址（notify_url）发送最终的订单处理结果数据，商户按照文档规范验证签名，验证通过后进行后续的业务逻辑处理，并做好业务日志记录。在有同步通知的前提下，订单处理结果以异步通知为准；

常见问题
无效的签名验证？
如果使用我方提供的DEMO，替换完商户号、签名KEY、数据加密KEY，出现该问题，说明签名KEY出错，请登陆汇付宝商户后台核对签名KEY，如果仍然存在该问题，请按照文档要求检查签名值计算部分是否存在疏漏，比如参与签名的参数是否正确、顺序是否一致、大小写转换和URL编码是否处理等。

商户密钥（KEY）如何使用？
商户密钥（KEY）有两种，第一种是签名密钥（全部接口都包括），第二种是数据加密密钥（快捷AES加密密钥、卡支付3DES加密密钥、实名认证3DES加密密钥）。签名密钥用在签名验证的时候参与签名计算，数据加密密钥用在加密算法中，密钥的值分别都是字符串类型，由我方运营同事分配。具体的用法请参照接口文档规范。

商户如何做更新订单状态等业务逻辑处理？
同步通知和异步通知同时存在的前提下，商户做支付结果的业务逻辑处理以异步通知返回为准，特别注意！如果对接卡类支付，在做业务逻辑处理时以返回的实际支付金额和订单状态组合起来进行校验，不要单独只看订单状态，以免造成经济损失。

异步通知如何接收处理？
异步通知总共通知五次，商户要保证只有效处理一次，异步通知的处理第一步是先获取参数并进行签名验证（保证数据一致性），验证通过返回“ok”并进行后续的业务逻辑处理（比如更新订单状态），否则返回“error”，这时可以反馈给我方客服同事进行补通知操作，也可以通过查询接口自行更新订单状态 ，同时，建议在此处做好业务日志记录。

查询接口有什么用？
查询接口的主要作用是“补单”，即出现订单状态为“处理中”等异常单情况，程序触发查询接口请求完成订单的二次处理，如查询结果发现单据状态仍然异常，请联系我方运营同事人工处理。

接口报错：“传入的参数信息有误，或您停留的时间太长！”？
错误原因是session丢失，
1>：用户检查一下浏览器是否禁用了cookie；
2>：商户的系统在业务逻辑处理中是否丢失session；
3>：不兼容低版本浏览器比如IE6造成的；

声明
对接的具体要求因接口差异，请以对应接口的文档规范为准！本文档仅作为参考，商户对接产生的技术问题，以及造成的任何潜在损失，我方不承担任何责任。

汇付宝技术支持
邮箱：zhoujianhua@9186.com
电话：（010）59798877-146


